{% load i18n %}
{% load compress %}
{% load analytics_tags %}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <title>{% block head_title %}{% trans "Taskboard" %}{% endblock %}</title>
        {% compress css %}
        <link rel="stylesheet" href="{{ STATIC_URL }}pinax/css/base.css" />
        <link rel="stylesheet" href="{{ STATIC_URL }}pinax/css/tabs.css" />
        <link rel="stylesheet" href="{{STATIC_URL}}agilito/css/taskboard.css" type="text/css" />
        {% endcompress %}
    </head>
    <body>
        {% block flash_messages %}{% include "_flash_messages.html" %}{% endblock %}
        <div class="filters">
            <a href="{% url iteration_status_with_id current_project.id,current_iteration.id  %}">{% trans "Back to iteration" %}</a>
            <form action="" class="uniForm">
                <fieldset class="inlineLabels">
                    <legend>{% trans "Filters" %}</legend>
                    <div class="ctrlHolder">
                        <label for="owner_filter">Owner</label>
                        <select name="owner_filter" id="owner_filter">
                                <option value="ALL" selected>{% trans "Select an owner..." %}</option>
                            {% for member in current_project.project_members.all %}
                                <option value="{{member.email}}">{{member.email}}</option>
                            {% endfor %}
                        </select>
                    </div>
                </fieldset>
            </form>
        </div>
        <div class="taskboard">
            <div class="division bg">
                <div class="lane"><div class="color"></div></div>
                <div class="lane"><div class="color"></div></div>
                <div class="lane"><div class="color"></div></div>
                <div class="lane"><div class="color"></div></div>
            </div>
            <div class="cont">
                {% for us in stories %}
                {% if forloop.first %}
                <div class="division head">
                    <div class="lane">{% trans "Story" %}</div>
                    <div class="lane">{% trans "To Do" %}</div>
                    <div class="lane">{% trans "In Progress" %}</div>
                    <div class="lane">{% trans "Done" %}</div>
                </div>
                {% endif %}
                <div class="division">
                    <div class="lane">
                        <div class="story">
                            <div class="name"><a href="{{ us.get_absolute_url }}">{{ us.name }}</a></div>
                            <div class="id">{{ us.code }}</div>
                            <div class="rank" title="rank">{{ us.relative_rank }}</div>
                            <div class="remaining" title="remaining">{{ us.remaining|default_if_none:"-" }}</div>
                        </div>
                    </div>
                    <div class="lane todo">
                        &nbsp;
                        {% for ta in us.tasks.todo %}
                        {% include "agilito/taskboard_task.html" %}
                        {% endfor %}
                    </div>
                    <div class="lane in_progress">
                        &nbsp;
                        {% for ta in us.tasks.in_progress %}
                        {% include "agilito/taskboard_task.html" %}
                        {% endfor %}
                    </div>
                    <div class="lane done">
                        &nbsp;
                        {% for ta in us.tasks.done %}
                        {% include "agilito/taskboard_task.html" %}
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% compress js %}
        <script src="{{ STATIC_URL }}pinax/js/jquery-1.5.2.js" type="text/javascript"></script>
        <script type="text/javascript">
        $(function(){
           $('#owner_filter').change(function(){
               var current_value = $(this).val();
               if (current_value == "ALL") {
                   $('.filterable').show();
               } else {
                   $('.filterable').each(function() {
                       if ($('.owner',this).html() != current_value) {
                           $('.filterable').hide();
                       } else {
                           $('.filterable').show();
                       }
                   });
               }
           });
        });
        </script>
        {% analytics %}
        {% endcompress %}
    </body>
</html>
